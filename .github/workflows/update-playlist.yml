name: Update YouTube Playlist

on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Repository auschecken
        uses: actions/checkout@v3

      - name: Python installieren
        uses: actions/setup-python@v4
        with:
          python-version: "3.x"

      - name: Playlist aktualisieren
        run: |
          pip install requests
          python3 << 'EOF'
          import requests, json, re

CHANNEL_ID = "UU8K8w937XhG3KaCHE1xjQvg"

url = f"https://www.youtube.com/feeds/videos.xml?channel_id={CHANNEL_ID}"

headers = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64)"
}

r = requests.get(url, headers=headers)

if r.status_code != 200:
    print("Fehler beim Abrufen des Feeds:", r.status_code)
    exit(1)

ids = re.findall(r"<yt:videoId>(.*?)</yt:videoId>", r.text)

print("Gefundene IDs:", ids)

with open("playlist.json", "w") as f:
    json.dump(ids, f)

print("playlist.json aktualisiert.")

      - name: Änderungen committen
        run: |
          git config --local user.email "actions@github.com"
          git config --local user.name "GitHub Actions"
          git add playlist.json
          git commit -m "Auto-update playlist" || echo "Keine Änderungen"

      - name: Änderungen pushen
        uses: ad-m/github-push-action@v0.6.0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
